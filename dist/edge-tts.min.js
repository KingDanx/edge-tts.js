import{createRequire as oI}from"node:module";var cI=Object.create;var{getPrototypeOf:nI,defineProperty:m_,getOwnPropertyNames:rI}=Object;var aI=Object.prototype.hasOwnProperty;var c=(_,I,R)=>{R=_!=null?cI(nI(_)):{};let K=I||!_||!_.__esModule?m_(R,"default",{value:_,enumerable:!0}):R;for(let $ of rI(_))if(!aI.call(K,$))m_(K,$,{get:()=>_[$],enumerable:!0});return K};var C=(_,I)=>()=>(I||_((I={exports:{}}).exports,I),I.exports);var O=oI(import.meta.url);var i_=C((w4,b_)=>{var{Duplex:KR}=O("stream");function l_(_){_.emit("close")}function $R(){if(!this.destroyed&&this._writableState.finished)this.destroy()}function p_(_){if(this.removeListener("error",p_),this.destroy(),this.listenerCount("error")===0)this.emit("error",_)}function NR(_,I){let R=!0,K=new KR({...I,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return _.on("message",function $(N,V){let Z=!V&&K._readableState.objectMode?N.toString():N;if(!K.push(Z))_.pause()}),_.once("error",function $(N){if(K.destroyed)return;R=!1,K.destroy(N)}),_.once("close",function $(){if(K.destroyed)return;K.push(null)}),K._destroy=function($,N){if(_.readyState===_.CLOSED){N($),process.nextTick(l_,K);return}let V=!1;if(_.once("error",function Z(J){V=!0,N(J)}),_.once("close",function Z(){if(!V)N($);process.nextTick(l_,K)}),R)_.terminate()},K._final=function($){if(_.readyState===_.CONNECTING){_.once("open",function N(){K._final($)});return}if(_._socket===null)return;if(_._socket._writableState.finished){if($(),K._readableState.endEmitted)K.destroy()}else _._socket.once("finish",function N(){$()}),_.close()},K._read=function(){if(_.isPaused)_.resume()},K._write=function($,N,V){if(_.readyState===_.CONNECTING){_.once("open",function Z(){K._write($,N,V)});return}_.send($,V)},K.on("end",$R),K.on("error",p_),K}b_.exports=NR});var L=C((h4,c_)=>{var k_=["nodebuffer","arraybuffer","fragments"],d_=typeof Blob!=="undefined";if(d_)k_.push("blob");c_.exports={BINARY_TYPES:k_,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:d_,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var n=C((m4,K_)=>{var{EMPTY_BUFFER:VR}=L(),T_=Buffer[Symbol.species];function JR(_,I){if(_.length===0)return VR;if(_.length===1)return _[0];let R=Buffer.allocUnsafe(I),K=0;for(let $=0;$<_.length;$++){let N=_[$];R.set(N,K),K+=N.length}if(K<I)return new T_(R.buffer,R.byteOffset,K);return R}function n_(_,I,R,K,$){for(let N=0;N<$;N++)R[K+N]=_[N]^I[N&3]}function r_(_,I){for(let R=0;R<_.length;R++)_[R]^=I[R&3]}function ZR(_){if(_.length===_.buffer.byteLength)return _.buffer;return _.buffer.slice(_.byteOffset,_.byteOffset+_.length)}function C_(_){if(C_.readOnly=!0,Buffer.isBuffer(_))return _;let I;if(_ instanceof ArrayBuffer)I=new T_(_);else if(ArrayBuffer.isView(_))I=new T_(_.buffer,_.byteOffset,_.byteLength);else I=Buffer.from(_),C_.readOnly=!1;return I}K_.exports={concat:JR,mask:n_,toArrayBuffer:ZR,toBuffer:C_,unmask:r_};if(!process.env.WS_NO_BUFFER_UTIL)try{let _=(()=>{throw new Error("Cannot require module "+"bufferutil");})();K_.exports.mask=function(I,R,K,$,N){if(N<48)n_(I,R,K,$,N);else _.mask(I,R,K,$,N)},K_.exports.unmask=function(I,R){if(I.length<32)r_(I,R);else _.unmask(I,R)}}catch(_){}});var t_=C((f4,s_)=>{var a_=Symbol("kDone"),F_=Symbol("kRun");class o_{constructor(_){this[a_]=()=>{this.pending--,this[F_]()},this.concurrency=_||1/0,this.jobs=[],this.pending=0}add(_){this.jobs.push(_),this[F_]()}[F_](){if(this.pending===this.concurrency)return;if(this.jobs.length){let _=this.jobs.shift();this.pending++,_(this[a_])}}}s_.exports=o_});var o=C((u4,KI)=>{var r=O("zlib"),e_=n(),GR=t_(),{kStatusCode:_I}=L(),XR=Buffer[Symbol.species],zR=Buffer.from([0,0,255,255]),V_=Symbol("permessage-deflate"),x=Symbol("total-length"),a=Symbol("callback"),E=Symbol("buffers"),N_=Symbol("error"),$_;class II{constructor(_,I,R){if(this._maxPayload=R|0,this._options=_||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!I,this._deflate=null,this._inflate=null,this.params=null,!$_){let K=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;$_=new GR(K)}}static get extensionName(){return"permessage-deflate"}offer(){let _={};if(this._options.serverNoContextTakeover)_.server_no_context_takeover=!0;if(this._options.clientNoContextTakeover)_.client_no_context_takeover=!0;if(this._options.serverMaxWindowBits)_.server_max_window_bits=this._options.serverMaxWindowBits;if(this._options.clientMaxWindowBits)_.client_max_window_bits=this._options.clientMaxWindowBits;else if(this._options.clientMaxWindowBits==null)_.client_max_window_bits=!0;return _}accept(_){return _=this.normalizeParams(_),this.params=this._isServer?this.acceptAsServer(_):this.acceptAsClient(_),this.params}cleanup(){if(this._inflate)this._inflate.close(),this._inflate=null;if(this._deflate){let _=this._deflate[a];if(this._deflate.close(),this._deflate=null,_)_(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(_){let I=this._options,R=_.find((K)=>{if(I.serverNoContextTakeover===!1&&K.server_no_context_takeover||K.server_max_window_bits&&(I.serverMaxWindowBits===!1||typeof I.serverMaxWindowBits==="number"&&I.serverMaxWindowBits>K.server_max_window_bits)||typeof I.clientMaxWindowBits==="number"&&!K.client_max_window_bits)return!1;return!0});if(!R)throw new Error("None of the extension offers can be accepted");if(I.serverNoContextTakeover)R.server_no_context_takeover=!0;if(I.clientNoContextTakeover)R.client_no_context_takeover=!0;if(typeof I.serverMaxWindowBits==="number")R.server_max_window_bits=I.serverMaxWindowBits;if(typeof I.clientMaxWindowBits==="number")R.client_max_window_bits=I.clientMaxWindowBits;else if(R.client_max_window_bits===!0||I.clientMaxWindowBits===!1)delete R.client_max_window_bits;return R}acceptAsClient(_){let I=_[0];if(this._options.clientNoContextTakeover===!1&&I.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!I.client_max_window_bits){if(typeof this._options.clientMaxWindowBits==="number")I.client_max_window_bits=this._options.clientMaxWindowBits}else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits==="number"&&I.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return I}normalizeParams(_){return _.forEach((I)=>{Object.keys(I).forEach((R)=>{let K=I[R];if(K.length>1)throw new Error(`Parameter "${R}" must have only a single value`);if(K=K[0],R==="client_max_window_bits"){if(K!==!0){let $=+K;if(!Number.isInteger($)||$<8||$>15)throw new TypeError(`Invalid value for parameter "${R}": ${K}`);K=$}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${R}": ${K}`)}else if(R==="server_max_window_bits"){let $=+K;if(!Number.isInteger($)||$<8||$>15)throw new TypeError(`Invalid value for parameter "${R}": ${K}`);K=$}else if(R==="client_no_context_takeover"||R==="server_no_context_takeover"){if(K!==!0)throw new TypeError(`Invalid value for parameter "${R}": ${K}`)}else throw new Error(`Unknown parameter "${R}"`);I[R]=K})}),_}decompress(_,I,R){$_.add((K)=>{this._decompress(_,I,($,N)=>{K(),R($,N)})})}compress(_,I,R){$_.add((K)=>{this._compress(_,I,($,N)=>{K(),R($,N)})})}_decompress(_,I,R){let K=this._isServer?"client":"server";if(!this._inflate){let $=`${K}_max_window_bits`,N=typeof this.params[$]!=="number"?r.Z_DEFAULT_WINDOWBITS:this.params[$];this._inflate=r.createInflateRaw({...this._options.zlibInflateOptions,windowBits:N}),this._inflate[V_]=this,this._inflate[x]=0,this._inflate[E]=[],this._inflate.on("error",AR),this._inflate.on("data",RI)}if(this._inflate[a]=R,this._inflate.write(_),I)this._inflate.write(zR);this._inflate.flush(()=>{let $=this._inflate[N_];if($){this._inflate.close(),this._inflate=null,R($);return}let N=e_.concat(this._inflate[E],this._inflate[x]);if(this._inflate._readableState.endEmitted)this._inflate.close(),this._inflate=null;else if(this._inflate[x]=0,this._inflate[E]=[],I&&this.params[`${K}_no_context_takeover`])this._inflate.reset();R(null,N)})}_compress(_,I,R){let K=this._isServer?"server":"client";if(!this._deflate){let $=`${K}_max_window_bits`,N=typeof this.params[$]!=="number"?r.Z_DEFAULT_WINDOWBITS:this.params[$];this._deflate=r.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:N}),this._deflate[x]=0,this._deflate[E]=[],this._deflate.on("data",HR)}this._deflate[a]=R,this._deflate.write(_),this._deflate.flush(r.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let $=e_.concat(this._deflate[E],this._deflate[x]);if(I)$=new XR($.buffer,$.byteOffset,$.length-4);if(this._deflate[a]=null,this._deflate[x]=0,this._deflate[E]=[],I&&this.params[`${K}_no_context_takeover`])this._deflate.reset();R(null,$)})}}KI.exports=II;function HR(_){this[E].push(_),this[x]+=_.length}function RI(_){if(this[x]+=_.length,this[V_]._maxPayload<1||this[x]<=this[V_]._maxPayload){this[E].push(_);return}this[N_]=new RangeError("Max payload size exceeded"),this[N_].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[N_][_I]=1009,this.removeListener("data",RI),this.reset()}function AR(_){this[V_]._inflate=null,_[_I]=1007,this[a](_)}});var u=C((l4,J_)=>{var{isUtf8:$I}=O("buffer"),{hasBlob:QR}=L(),OR=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function YR(_){return _>=1000&&_<=1014&&_!==1004&&_!==1005&&_!==1006||_>=3000&&_<=4999}function U_(_){let I=_.length,R=0;while(R<I)if((_[R]&128)===0)R++;else if((_[R]&224)===192){if(R+1===I||(_[R+1]&192)!==128||(_[R]&254)===192)return!1;R+=2}else if((_[R]&240)===224){if(R+2>=I||(_[R+1]&192)!==128||(_[R+2]&192)!==128||_[R]===224&&(_[R+1]&224)===128||_[R]===237&&(_[R+1]&224)===160)return!1;R+=3}else if((_[R]&248)===240){if(R+3>=I||(_[R+1]&192)!==128||(_[R+2]&192)!==128||(_[R+3]&192)!==128||_[R]===240&&(_[R+1]&240)===128||_[R]===244&&_[R+1]>143||_[R]>244)return!1;R+=4}else return!1;return!0}function jR(_){return QR&&typeof _==="object"&&typeof _.arrayBuffer==="function"&&typeof _.type==="string"&&typeof _.stream==="function"&&(_[Symbol.toStringTag]==="Blob"||_[Symbol.toStringTag]==="File")}J_.exports={isBlob:jR,isValidStatusCode:YR,isValidUTF8:U_,tokenChars:OR};if($I)J_.exports.isValidUTF8=function(_){return _.length<24?U_(_):$I(_)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let _=(()=>{throw new Error("Cannot require module "+"utf-8-validate");})();J_.exports.isValidUTF8=function(I){return I.length<32?U_(I):_(I)}}catch(_){}});var P_=C((p4,GI)=>{var{Writable:MR}=O("stream"),NI=o(),{BINARY_TYPES:TR,EMPTY_BUFFER:VI,kStatusCode:CR,kWebSocket:FR}=L(),{concat:D_,toArrayBuffer:UR,unmask:DR}=n(),{isValidStatusCode:PR,isValidUTF8:JI}=u(),Z_=Buffer[Symbol.species];class ZI extends MR{constructor(_={}){super();this._allowSynchronousEvents=_.allowSynchronousEvents!==void 0?_.allowSynchronousEvents:!0,this._binaryType=_.binaryType||TR[0],this._extensions=_.extensions||{},this._isServer=!!_.isServer,this._maxPayload=_.maxPayload|0,this._skipUTF8Validation=!!_.skipUTF8Validation,this[FR]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(_,I,R){if(this._opcode===8&&this._state==0)return R();this._bufferedBytes+=_.length,this._buffers.push(_),this.startLoop(R)}consume(_){if(this._bufferedBytes-=_,_===this._buffers[0].length)return this._buffers.shift();if(_<this._buffers[0].length){let R=this._buffers[0];return this._buffers[0]=new Z_(R.buffer,R.byteOffset+_,R.length-_),new Z_(R.buffer,R.byteOffset,_)}let I=Buffer.allocUnsafe(_);do{let R=this._buffers[0],K=I.length-_;if(_>=R.length)I.set(this._buffers.shift(),K);else I.set(new Uint8Array(R.buffer,R.byteOffset,_),K),this._buffers[0]=new Z_(R.buffer,R.byteOffset+_,R.length-_);_-=R.length}while(_>0);return I}startLoop(_){this._loop=!0;do switch(this._state){case 0:this.getInfo(_);break;case 1:this.getPayloadLength16(_);break;case 2:this.getPayloadLength64(_);break;case 3:this.getMask();break;case 4:this.getData(_);break;case 5:case 6:this._loop=!1;return}while(this._loop);if(!this._errored)_()}getInfo(_){if(this._bufferedBytes<2){this._loop=!1;return}let I=this.consume(2);if((I[0]&48)!==0){let K=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");_(K);return}let R=(I[0]&64)===64;if(R&&!this._extensions[NI.extensionName]){let K=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(K);return}if(this._fin=(I[0]&128)===128,this._opcode=I[0]&15,this._payloadLength=I[1]&127,this._opcode===0){if(R){let K=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(K);return}if(!this._fragmented){let K=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");_(K);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let K=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");_(K);return}this._compressed=R}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let K=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");_(K);return}if(R){let K=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(K);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let K=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");_(K);return}}else{let K=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");_(K);return}if(!this._fin&&!this._fragmented)this._fragmented=this._opcode;if(this._masked=(I[1]&128)===128,this._isServer){if(!this._masked){let K=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");_(K);return}}else if(this._masked){let K=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");_(K);return}if(this._payloadLength===126)this._state=1;else if(this._payloadLength===127)this._state=2;else this.haveLength(_)}getPayloadLength16(_){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(_)}getPayloadLength64(_){if(this._bufferedBytes<8){this._loop=!1;return}let I=this.consume(8),R=I.readUInt32BE(0);if(R>Math.pow(2,21)-1){let K=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");_(K);return}this._payloadLength=R*Math.pow(2,32)+I.readUInt32BE(4),this.haveLength(_)}haveLength(_){if(this._payloadLength&&this._opcode<8){if(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0){let I=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");_(I);return}}if(this._masked)this._state=3;else this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(_){let I=VI;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}if(I=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0)DR(I,this._mask)}if(this._opcode>7){this.controlMessage(I,_);return}if(this._compressed){this._state=5,this.decompress(I,_);return}if(I.length)this._messageLength=this._totalPayloadLength,this._fragments.push(I);this.dataMessage(_)}decompress(_,I){this._extensions[NI.extensionName].decompress(_,this._fin,(K,$)=>{if(K)return I(K);if($.length){if(this._messageLength+=$.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let N=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");I(N);return}this._fragments.push($)}if(this.dataMessage(I),this._state===0)this.startLoop(I)})}dataMessage(_){if(!this._fin){this._state=0;return}let I=this._messageLength,R=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let K;if(this._binaryType==="nodebuffer")K=D_(R,I);else if(this._binaryType==="arraybuffer")K=UR(D_(R,I));else if(this._binaryType==="blob")K=new Blob(R);else K=R;if(this._allowSynchronousEvents)this.emit("message",K,!0),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",K,!0),this._state=0,this.startLoop(_)})}else{let K=D_(R,I);if(!this._skipUTF8Validation&&!JI(K)){let $=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");_($);return}if(this._state===5||this._allowSynchronousEvents)this.emit("message",K,!1),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",K,!1),this._state=0,this.startLoop(_)})}}controlMessage(_,I){if(this._opcode===8){if(_.length===0)this._loop=!1,this.emit("conclude",1005,VI),this.end();else{let R=_.readUInt16BE(0);if(!PR(R)){let $=this.createError(RangeError,`invalid status code ${R}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");I($);return}let K=new Z_(_.buffer,_.byteOffset+2,_.length-2);if(!this._skipUTF8Validation&&!JI(K)){let $=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");I($);return}this._loop=!1,this.emit("conclude",R,K),this.end()}this._state=0;return}if(this._allowSynchronousEvents)this.emit(this._opcode===9?"ping":"pong",_),this._state=0;else this._state=6,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",_),this._state=0,this.startLoop(I)})}createError(_,I,R,K,$){this._loop=!1,this._errored=!0;let N=new _(R?`Invalid WebSocket frame: ${I}`:I);return Error.captureStackTrace(N,this.createError),N.code=$,N[CR]=K,N}}GI.exports=ZI});var L_=C((i4,HI)=>{var{Duplex:b4}=O("stream"),{randomFillSync:BR}=O("crypto"),XI=o(),{EMPTY_BUFFER:LR,kWebSocket:xR,NOOP:qR}=L(),{isBlob:l,isValidStatusCode:ER}=u(),{mask:zI,toBuffer:v}=n(),U=Symbol("kByteLength"),WR=Buffer.alloc(4),g,p=8192,P=0,SR=1,yR=2;class W{constructor(_,I,R){if(this._extensions=I||{},R)this._generateMask=R,this._maskBuffer=Buffer.alloc(4);this._socket=_,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=P,this.onerror=qR,this[xR]=void 0}static frame(_,I){let R,K=!1,$=2,N=!1;if(I.mask){if(R=I.maskBuffer||WR,I.generateMask)I.generateMask(R);else{if(p===8192){if(g===void 0)g=Buffer.alloc(8192);BR(g,0,8192),p=0}R[0]=g[p++],R[1]=g[p++],R[2]=g[p++],R[3]=g[p++]}N=(R[0]|R[1]|R[2]|R[3])===0,$=6}let V;if(typeof _==="string")if((!I.mask||N)&&I[U]!==void 0)V=I[U];else _=Buffer.from(_),V=_.length;else V=_.length,K=I.mask&&I.readOnly&&!N;let Z=V;if(V>=65536)$+=8,Z=127;else if(V>125)$+=2,Z=126;let J=Buffer.allocUnsafe(K?V+$:$);if(J[0]=I.fin?I.opcode|128:I.opcode,I.rsv1)J[0]|=64;if(J[1]=Z,Z===126)J.writeUInt16BE(V,2);else if(Z===127)J[2]=J[3]=0,J.writeUIntBE(V,4,6);if(!I.mask)return[J,_];if(J[1]|=128,J[$-4]=R[0],J[$-3]=R[1],J[$-2]=R[2],J[$-1]=R[3],N)return[J,_];if(K)return zI(_,R,J,$,V),[J];return zI(_,R,_,0,V),[J,_]}close(_,I,R,K){let $;if(_===void 0)$=LR;else if(typeof _!=="number"||!ER(_))throw new TypeError("First argument must be a valid error code number");else if(I===void 0||!I.length)$=Buffer.allocUnsafe(2),$.writeUInt16BE(_,0);else{let V=Buffer.byteLength(I);if(V>123)throw new RangeError("The message must not be greater than 123 bytes");if($=Buffer.allocUnsafe(2+V),$.writeUInt16BE(_,0),typeof I==="string")$.write(I,2);else $.set(I,2)}let N={[U]:$.length,fin:!0,generateMask:this._generateMask,mask:R,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};if(this._state!==P)this.enqueue([this.dispatch,$,!1,N,K]);else this.sendFrame(W.frame($,N),K)}ping(_,I,R){let K,$;if(typeof _==="string")K=Buffer.byteLength(_),$=!1;else if(l(_))K=_.size,$=!1;else _=v(_),K=_.length,$=v.readOnly;if(K>125)throw new RangeError("The data size must not be greater than 125 bytes");let N={[U]:K,fin:!0,generateMask:this._generateMask,mask:I,maskBuffer:this._maskBuffer,opcode:9,readOnly:$,rsv1:!1};if(l(_))if(this._state!==P)this.enqueue([this.getBlobData,_,!1,N,R]);else this.getBlobData(_,!1,N,R);else if(this._state!==P)this.enqueue([this.dispatch,_,!1,N,R]);else this.sendFrame(W.frame(_,N),R)}pong(_,I,R){let K,$;if(typeof _==="string")K=Buffer.byteLength(_),$=!1;else if(l(_))K=_.size,$=!1;else _=v(_),K=_.length,$=v.readOnly;if(K>125)throw new RangeError("The data size must not be greater than 125 bytes");let N={[U]:K,fin:!0,generateMask:this._generateMask,mask:I,maskBuffer:this._maskBuffer,opcode:10,readOnly:$,rsv1:!1};if(l(_))if(this._state!==P)this.enqueue([this.getBlobData,_,!1,N,R]);else this.getBlobData(_,!1,N,R);else if(this._state!==P)this.enqueue([this.dispatch,_,!1,N,R]);else this.sendFrame(W.frame(_,N),R)}send(_,I,R){let K=this._extensions[XI.extensionName],$=I.binary?2:1,N=I.compress,V,Z;if(typeof _==="string")V=Buffer.byteLength(_),Z=!1;else if(l(_))V=_.size,Z=!1;else _=v(_),V=_.length,Z=v.readOnly;if(this._firstFragment){if(this._firstFragment=!1,N&&K&&K.params[K._isServer?"server_no_context_takeover":"client_no_context_takeover"])N=V>=K._threshold;this._compress=N}else N=!1,$=0;if(I.fin)this._firstFragment=!0;let J={[U]:V,fin:I.fin,generateMask:this._generateMask,mask:I.mask,maskBuffer:this._maskBuffer,opcode:$,readOnly:Z,rsv1:N};if(l(_))if(this._state!==P)this.enqueue([this.getBlobData,_,this._compress,J,R]);else this.getBlobData(_,this._compress,J,R);else if(this._state!==P)this.enqueue([this.dispatch,_,this._compress,J,R]);else this.dispatch(_,this._compress,J,R)}getBlobData(_,I,R,K){this._bufferedBytes+=R[U],this._state=yR,_.arrayBuffer().then(($)=>{if(this._socket.destroyed){let V=new Error("The socket was closed while the blob was being read");process.nextTick(B_,this,V,K);return}this._bufferedBytes-=R[U];let N=v($);if(!I)this._state=P,this.sendFrame(W.frame(N,R),K),this.dequeue();else this.dispatch(N,I,R,K)}).catch(($)=>{process.nextTick(vR,this,$,K)})}dispatch(_,I,R,K){if(!I){this.sendFrame(W.frame(_,R),K);return}let $=this._extensions[XI.extensionName];this._bufferedBytes+=R[U],this._state=SR,$.compress(_,R.fin,(N,V)=>{if(this._socket.destroyed){let Z=new Error("The socket was closed while data was being compressed");B_(this,Z,K);return}this._bufferedBytes-=R[U],this._state=P,R.readOnly=!1,this.sendFrame(W.frame(V,R),K),this.dequeue()})}dequeue(){while(this._state===P&&this._queue.length){let _=this._queue.shift();this._bufferedBytes-=_[3][U],Reflect.apply(_[0],this,_.slice(1))}}enqueue(_){this._bufferedBytes+=_[3][U],this._queue.push(_)}sendFrame(_,I){if(_.length===2)this._socket.cork(),this._socket.write(_[0]),this._socket.write(_[1],I),this._socket.uncork();else this._socket.write(_[0],I)}}HI.exports=W;function B_(_,I,R){if(typeof R==="function")R(I);for(let K=0;K<_._queue.length;K++){let $=_._queue[K],N=$[$.length-1];if(typeof N==="function")N(I)}}function vR(_,I,R){B_(_,I,R),_.onerror(I)}});var FI=C((k4,CI)=>{var{kForOnEventAttribute:s,kListener:x_}=L(),AI=Symbol("kCode"),QI=Symbol("kData"),OI=Symbol("kError"),YI=Symbol("kMessage"),jI=Symbol("kReason"),b=Symbol("kTarget"),MI=Symbol("kType"),TI=Symbol("kWasClean");class S{constructor(_){this[b]=null,this[MI]=_}get target(){return this[b]}get type(){return this[MI]}}Object.defineProperty(S.prototype,"target",{enumerable:!0});Object.defineProperty(S.prototype,"type",{enumerable:!0});class i extends S{constructor(_,I={}){super(_);this[AI]=I.code===void 0?0:I.code,this[jI]=I.reason===void 0?"":I.reason,this[TI]=I.wasClean===void 0?!1:I.wasClean}get code(){return this[AI]}get reason(){return this[jI]}get wasClean(){return this[TI]}}Object.defineProperty(i.prototype,"code",{enumerable:!0});Object.defineProperty(i.prototype,"reason",{enumerable:!0});Object.defineProperty(i.prototype,"wasClean",{enumerable:!0});class t extends S{constructor(_,I={}){super(_);this[OI]=I.error===void 0?null:I.error,this[YI]=I.message===void 0?"":I.message}get error(){return this[OI]}get message(){return this[YI]}}Object.defineProperty(t.prototype,"error",{enumerable:!0});Object.defineProperty(t.prototype,"message",{enumerable:!0});class X_ extends S{constructor(_,I={}){super(_);this[QI]=I.data===void 0?null:I.data}get data(){return this[QI]}}Object.defineProperty(X_.prototype,"data",{enumerable:!0});var gR={addEventListener(_,I,R={}){for(let $ of this.listeners(_))if(!R[s]&&$[x_]===I&&!$[s])return;let K;if(_==="message")K=function $(N,V){let Z=new X_("message",{data:V?N:N.toString()});Z[b]=this,G_(I,this,Z)};else if(_==="close")K=function $(N,V){let Z=new i("close",{code:N,reason:V.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});Z[b]=this,G_(I,this,Z)};else if(_==="error")K=function $(N){let V=new t("error",{error:N,message:N.message});V[b]=this,G_(I,this,V)};else if(_==="open")K=function $(){let N=new S("open");N[b]=this,G_(I,this,N)};else return;if(K[s]=!!R[s],K[x_]=I,R.once)this.once(_,K);else this.on(_,K)},removeEventListener(_,I){for(let R of this.listeners(_))if(R[x_]===I&&!R[s]){this.removeListener(_,R);break}}};CI.exports={CloseEvent:i,ErrorEvent:t,Event:S,EventTarget:gR,MessageEvent:X_};function G_(_,I,R){if(typeof _==="object"&&_.handleEvent)_.handleEvent.call(_,R);else _.call(I,R)}});var q_=C((d4,UI)=>{var{tokenChars:e}=u();function B(_,I,R){if(_[I]===void 0)_[I]=[R];else _[I].push(R)}function wR(_){let I=Object.create(null),R=Object.create(null),K=!1,$=!1,N=!1,V,Z,J=-1,G=-1,H=-1,z=0;for(;z<_.length;z++)if(G=_.charCodeAt(z),V===void 0)if(H===-1&&e[G]===1){if(J===-1)J=z}else if(z!==0&&(G===32||G===9)){if(H===-1&&J!==-1)H=z}else if(G===59||G===44){if(J===-1)throw new SyntaxError(`Unexpected character at index ${z}`);if(H===-1)H=z;let M=_.slice(J,H);if(G===44)B(I,M,R),R=Object.create(null);else V=M;J=H=-1}else throw new SyntaxError(`Unexpected character at index ${z}`);else if(Z===void 0)if(H===-1&&e[G]===1){if(J===-1)J=z}else if(G===32||G===9){if(H===-1&&J!==-1)H=z}else if(G===59||G===44){if(J===-1)throw new SyntaxError(`Unexpected character at index ${z}`);if(H===-1)H=z;if(B(R,_.slice(J,H),!0),G===44)B(I,V,R),R=Object.create(null),V=void 0;J=H=-1}else if(G===61&&J!==-1&&H===-1)Z=_.slice(J,z),J=H=-1;else throw new SyntaxError(`Unexpected character at index ${z}`);else if($){if(e[G]!==1)throw new SyntaxError(`Unexpected character at index ${z}`);if(J===-1)J=z;else if(!K)K=!0;$=!1}else if(N)if(e[G]===1){if(J===-1)J=z}else if(G===34&&J!==-1)N=!1,H=z;else if(G===92)$=!0;else throw new SyntaxError(`Unexpected character at index ${z}`);else if(G===34&&_.charCodeAt(z-1)===61)N=!0;else if(H===-1&&e[G]===1){if(J===-1)J=z}else if(J!==-1&&(G===32||G===9)){if(H===-1)H=z}else if(G===59||G===44){if(J===-1)throw new SyntaxError(`Unexpected character at index ${z}`);if(H===-1)H=z;let M=_.slice(J,H);if(K)M=M.replace(/\\/g,""),K=!1;if(B(R,Z,M),G===44)B(I,V,R),R=Object.create(null),V=void 0;Z=void 0,J=H=-1}else throw new SyntaxError(`Unexpected character at index ${z}`);if(J===-1||N||G===32||G===9)throw new SyntaxError("Unexpected end of input");if(H===-1)H=z;let j=_.slice(J,H);if(V===void 0)B(I,j,R);else{if(Z===void 0)B(R,j,!0);else if(K)B(R,Z,j.replace(/\\/g,""));else B(R,Z,j);B(I,V,R)}return I}function hR(_){return Object.keys(_).map((I)=>{let R=_[I];if(!Array.isArray(R))R=[R];return R.map((K)=>{return[I].concat(Object.keys(K).map(($)=>{let N=K[$];if(!Array.isArray(N))N=[N];return N.map((V)=>V===!0?$:`${$}=${V}`).join("; ")})).join("; ")}).join(", ")}).join(", ")}UI.exports={format:hR,parse:wR}});var v_=C((r4,gI)=>{var mR=O("events"),fR=O("https"),uR=O("http"),BI=O("net"),lR=O("tls"),{randomBytes:pR,createHash:bR}=O("crypto"),{Duplex:c4,Readable:n4}=O("stream"),{URL:E_}=O("url"),y=o(),iR=P_(),kR=L_(),{isBlob:dR}=u(),{BINARY_TYPES:DI,EMPTY_BUFFER:z_,GUID:cR,kForOnEventAttribute:W_,kListener:nR,kStatusCode:rR,kWebSocket:Y,NOOP:LI}=L(),{EventTarget:{addEventListener:aR,removeEventListener:oR}}=FI(),{format:sR,parse:tR}=q_(),{toBuffer:eR}=n(),xI=Symbol("kAborted"),S_=[8,13],q=["CONNECTING","OPEN","CLOSING","CLOSED"],_4=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class X extends mR{constructor(_,I,R){super();if(this._binaryType=DI[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=z_,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=X.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,_!==null){if(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,I===void 0)I=[];else if(!Array.isArray(I))if(typeof I==="object"&&I!==null)R=I,I=[];else I=[I];qI(this,_,I,R)}else this._autoPong=R.autoPong,this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(_){if(!DI.includes(_))return;if(this._binaryType=_,this._receiver)this._receiver._binaryType=_}get bufferedAmount(){if(!this._socket)return this._bufferedAmount;return this._socket._writableState.length+this._sender._bufferedBytes}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(_,I,R){let K=new iR({allowSynchronousEvents:R.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:R.maxPayload,skipUTF8Validation:R.skipUTF8Validation}),$=new kR(_,this._extensions,R.generateMask);if(this._receiver=K,this._sender=$,this._socket=_,K[Y]=this,$[Y]=this,_[Y]=this,K.on("conclude",K4),K.on("drain",$4),K.on("error",N4),K.on("message",V4),K.on("ping",J4),K.on("pong",Z4),$.onerror=G4,_.setTimeout)_.setTimeout(0);if(_.setNoDelay)_.setNoDelay();if(I.length>0)_.unshift(I);_.on("close",SI),_.on("data",A_),_.on("end",yI),_.on("error",vI),this._readyState=X.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=X.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}if(this._extensions[y.extensionName])this._extensions[y.extensionName].cleanup();this._receiver.removeAllListeners(),this._readyState=X.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(_,I){if(this.readyState===X.CLOSED)return;if(this.readyState===X.CONNECTING){F(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===X.CLOSING){if(this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted))this._socket.end();return}this._readyState=X.CLOSING,this._sender.close(_,I,!this._isServer,(R)=>{if(R)return;if(this._closeFrameSent=!0,this._closeFrameReceived||this._receiver._writableState.errorEmitted)this._socket.end()}),WI(this)}pause(){if(this.readyState===X.CONNECTING||this.readyState===X.CLOSED)return;this._paused=!0,this._socket.pause()}ping(_,I,R){if(this.readyState===X.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof _==="function")R=_,_=I=void 0;else if(typeof I==="function")R=I,I=void 0;if(typeof _==="number")_=_.toString();if(this.readyState!==X.OPEN){y_(this,_,R);return}if(I===void 0)I=!this._isServer;this._sender.ping(_||z_,I,R)}pong(_,I,R){if(this.readyState===X.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof _==="function")R=_,_=I=void 0;else if(typeof I==="function")R=I,I=void 0;if(typeof _==="number")_=_.toString();if(this.readyState!==X.OPEN){y_(this,_,R);return}if(I===void 0)I=!this._isServer;this._sender.pong(_||z_,I,R)}resume(){if(this.readyState===X.CONNECTING||this.readyState===X.CLOSED)return;if(this._paused=!1,!this._receiver._writableState.needDrain)this._socket.resume()}send(_,I,R){if(this.readyState===X.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof I==="function")R=I,I={};if(typeof _==="number")_=_.toString();if(this.readyState!==X.OPEN){y_(this,_,R);return}let K={binary:typeof _!=="string",mask:!this._isServer,compress:!0,fin:!0,...I};if(!this._extensions[y.extensionName])K.compress=!1;this._sender.send(_||z_,K,R)}terminate(){if(this.readyState===X.CLOSED)return;if(this.readyState===X.CONNECTING){F(this,this._req,"WebSocket was closed before the connection was established");return}if(this._socket)this._readyState=X.CLOSING,this._socket.destroy()}}Object.defineProperty(X,"CONNECTING",{enumerable:!0,value:q.indexOf("CONNECTING")});Object.defineProperty(X.prototype,"CONNECTING",{enumerable:!0,value:q.indexOf("CONNECTING")});Object.defineProperty(X,"OPEN",{enumerable:!0,value:q.indexOf("OPEN")});Object.defineProperty(X.prototype,"OPEN",{enumerable:!0,value:q.indexOf("OPEN")});Object.defineProperty(X,"CLOSING",{enumerable:!0,value:q.indexOf("CLOSING")});Object.defineProperty(X.prototype,"CLOSING",{enumerable:!0,value:q.indexOf("CLOSING")});Object.defineProperty(X,"CLOSED",{enumerable:!0,value:q.indexOf("CLOSED")});Object.defineProperty(X.prototype,"CLOSED",{enumerable:!0,value:q.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((_)=>{Object.defineProperty(X.prototype,_,{enumerable:!0})});["open","error","close","message"].forEach((_)=>{Object.defineProperty(X.prototype,`on${_}`,{enumerable:!0,get(){for(let I of this.listeners(_))if(I[W_])return I[nR];return null},set(I){for(let R of this.listeners(_))if(R[W_]){this.removeListener(_,R);break}if(typeof I!=="function")return;this.addEventListener(_,I,{[W_]:!0})}})});X.prototype.addEventListener=aR;X.prototype.removeEventListener=oR;gI.exports=X;function qI(_,I,R,K){let $={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:S_[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...K,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(_._autoPong=$.autoPong,!S_.includes($.protocolVersion))throw new RangeError(`Unsupported protocol version: ${$.protocolVersion} (supported versions: ${S_.join(", ")})`);let N;if(I instanceof E_)N=I;else try{N=new E_(I)}catch(A){throw new SyntaxError(`Invalid URL: ${I}`)}if(N.protocol==="http:")N.protocol="ws:";else if(N.protocol==="https:")N.protocol="wss:";_._url=N.href;let V=N.protocol==="wss:",Z=N.protocol==="ws+unix:",J;if(N.protocol!=="ws:"&&!V&&!Z)J=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`;else if(Z&&!N.pathname)J="The URL's pathname is empty";else if(N.hash)J="The URL contains a fragment identifier";if(J){let A=new SyntaxError(J);if(_._redirects===0)throw A;else{H_(_,A);return}}let G=V?443:80,H=pR(16).toString("base64"),z=V?fR.request:uR.request,j=new Set,M;if($.createConnection=$.createConnection||(V?R4:I4),$.defaultPort=$.defaultPort||G,$.port=N.port||G,$.host=N.hostname.startsWith("[")?N.hostname.slice(1,-1):N.hostname,$.headers={...$.headers,"Sec-WebSocket-Version":$.protocolVersion,"Sec-WebSocket-Key":H,Connection:"Upgrade",Upgrade:"websocket"},$.path=N.pathname+N.search,$.timeout=$.handshakeTimeout,$.perMessageDeflate)M=new y($.perMessageDeflate!==!0?$.perMessageDeflate:{},!1,$.maxPayload),$.headers["Sec-WebSocket-Extensions"]=sR({[y.extensionName]:M.offer()});if(R.length){for(let A of R){if(typeof A!=="string"||!_4.test(A)||j.has(A))throw new SyntaxError("An invalid or duplicated subprotocol was specified");j.add(A)}$.headers["Sec-WebSocket-Protocol"]=R.join(",")}if($.origin)if($.protocolVersion<13)$.headers["Sec-WebSocket-Origin"]=$.origin;else $.headers.Origin=$.origin;if(N.username||N.password)$.auth=`${N.username}:${N.password}`;if(Z){let A=$.path.split(":");$.socketPath=A[0],$.path=A[1]}let Q;if($.followRedirects){if(_._redirects===0){_._originalIpc=Z,_._originalSecure=V,_._originalHostOrSocketPath=Z?$.socketPath:N.host;let A=K&&K.headers;if(K={...K,headers:{}},A)for(let[T,m]of Object.entries(A))K.headers[T.toLowerCase()]=m}else if(_.listenerCount("redirect")===0){let A=Z?_._originalIpc?$.socketPath===_._originalHostOrSocketPath:!1:_._originalIpc?!1:N.host===_._originalHostOrSocketPath;if(!A||_._originalSecure&&!V){if(delete $.headers.authorization,delete $.headers.cookie,!A)delete $.headers.host;$.auth=void 0}}if($.auth&&!K.headers.authorization)K.headers.authorization="Basic "+Buffer.from($.auth).toString("base64");if(Q=_._req=z($),_._redirects)_.emit("redirect",_.url,Q)}else Q=_._req=z($);if($.timeout)Q.on("timeout",()=>{F(_,Q,"Opening handshake has timed out")});if(Q.on("error",(A)=>{if(Q===null||Q[xI])return;Q=_._req=null,H_(_,A)}),Q.on("response",(A)=>{let T=A.headers.location,m=A.statusCode;if(T&&$.followRedirects&&m>=300&&m<400){if(++_._redirects>$.maxRedirects){F(_,Q,"Maximum redirects exceeded");return}Q.abort();let k;try{k=new E_(T,I)}catch(g_){let f=new SyntaxError(`Invalid URL: ${T}`);H_(_,f);return}qI(_,k,R,K)}else if(!_.emit("unexpected-response",Q,A))F(_,Q,`Unexpected server response: ${A.statusCode}`)}),Q.on("upgrade",(A,T,m)=>{if(_.emit("upgrade",A),_.readyState!==X.CONNECTING)return;Q=_._req=null;let k=A.headers.upgrade;if(k===void 0||k.toLowerCase()!=="websocket"){F(_,T,"Invalid Upgrade header");return}let g_=bR("sha1").update(H+cR).digest("base64");if(A.headers["sec-websocket-accept"]!==g_){F(_,T,"Invalid Sec-WebSocket-Accept header");return}let f=A.headers["sec-websocket-protocol"],d;if(f!==void 0){if(!j.size)d="Server sent a subprotocol but none was requested";else if(!j.has(f))d="Server sent an invalid subprotocol"}else if(j.size)d="Server sent no subprotocol";if(d){F(_,T,d);return}if(f)_._protocol=f;let w_=A.headers["sec-websocket-extensions"];if(w_!==void 0){if(!M){F(_,T,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let O_;try{O_=tR(w_)}catch(Y_){F(_,T,"Invalid Sec-WebSocket-Extensions header");return}let h_=Object.keys(O_);if(h_.length!==1||h_[0]!==y.extensionName){F(_,T,"Server indicated an extension that was not requested");return}try{M.accept(O_[y.extensionName])}catch(Y_){F(_,T,"Invalid Sec-WebSocket-Extensions header");return}_._extensions[y.extensionName]=M}_.setSocket(T,m,{allowSynchronousEvents:$.allowSynchronousEvents,generateMask:$.generateMask,maxPayload:$.maxPayload,skipUTF8Validation:$.skipUTF8Validation})}),$.finishRequest)$.finishRequest(Q,_);else Q.end()}function H_(_,I){_._readyState=X.CLOSING,_._errorEmitted=!0,_.emit("error",I),_.emitClose()}function I4(_){return _.path=_.socketPath,BI.connect(_)}function R4(_){if(_.path=void 0,!_.servername&&_.servername!=="")_.servername=BI.isIP(_.host)?"":_.host;return lR.connect(_)}function F(_,I,R){_._readyState=X.CLOSING;let K=new Error(R);if(Error.captureStackTrace(K,F),I.setHeader){if(I[xI]=!0,I.abort(),I.socket&&!I.socket.destroyed)I.socket.destroy();process.nextTick(H_,_,K)}else I.destroy(K),I.once("error",_.emit.bind(_,"error")),I.once("close",_.emitClose.bind(_))}function y_(_,I,R){if(I){let K=dR(I)?I.size:eR(I).length;if(_._socket)_._sender._bufferedBytes+=K;else _._bufferedAmount+=K}if(R){let K=new Error(`WebSocket is not open: readyState ${_.readyState} (${q[_.readyState]})`);process.nextTick(R,K)}}function K4(_,I){let R=this[Y];if(R._closeFrameReceived=!0,R._closeMessage=I,R._closeCode=_,R._socket[Y]===void 0)return;if(R._socket.removeListener("data",A_),process.nextTick(EI,R._socket),_===1005)R.close();else R.close(_,I)}function $4(){let _=this[Y];if(!_.isPaused)_._socket.resume()}function N4(_){let I=this[Y];if(I._socket[Y]!==void 0)I._socket.removeListener("data",A_),process.nextTick(EI,I._socket),I.close(_[rR]);if(!I._errorEmitted)I._errorEmitted=!0,I.emit("error",_)}function PI(){this[Y].emitClose()}function V4(_,I){this[Y].emit("message",_,I)}function J4(_){let I=this[Y];if(I._autoPong)I.pong(_,!this._isServer,LI);I.emit("ping",_)}function Z4(_){this[Y].emit("pong",_)}function EI(_){_.resume()}function G4(_){let I=this[Y];if(I.readyState===X.CLOSED)return;if(I.readyState===X.OPEN)I._readyState=X.CLOSING,WI(I);if(this._socket.end(),!I._errorEmitted)I._errorEmitted=!0,I.emit("error",_)}function WI(_){_._closeTimer=setTimeout(_._socket.destroy.bind(_._socket),30000)}function SI(){let _=this[Y];this.removeListener("close",SI),this.removeListener("data",A_),this.removeListener("end",yI),_._readyState=X.CLOSING;let I;if(!this._readableState.endEmitted&&!_._closeFrameReceived&&!_._receiver._writableState.errorEmitted&&(I=_._socket.read())!==null)_._receiver.write(I);if(_._receiver.end(),this[Y]=void 0,clearTimeout(_._closeTimer),_._receiver._writableState.finished||_._receiver._writableState.errorEmitted)_.emitClose();else _._receiver.on("error",PI),_._receiver.on("finish",PI)}function A_(_){if(!this[Y]._receiver.write(_))this.pause()}function yI(){let _=this[Y];_._readyState=X.CLOSING,_._receiver.end(),this.end()}function vI(){let _=this[Y];if(this.removeListener("error",vI),this.on("error",LI),_)_._readyState=X.CLOSING,this.destroy()}});var hI=C((a4,wI)=>{var{tokenChars:X4}=u();function z4(_){let I=new Set,R=-1,K=-1,$=0;for($;$<_.length;$++){let V=_.charCodeAt($);if(K===-1&&X4[V]===1){if(R===-1)R=$}else if($!==0&&(V===32||V===9)){if(K===-1&&R!==-1)K=$}else if(V===44){if(R===-1)throw new SyntaxError(`Unexpected character at index ${$}`);if(K===-1)K=$;let Z=_.slice(R,K);if(I.has(Z))throw new SyntaxError(`The "${Z}" subprotocol is duplicated`);I.add(Z),R=K=-1}else throw new SyntaxError(`Unexpected character at index ${$}`)}if(R===-1||K!==-1)throw new SyntaxError("Unexpected end of input");let N=_.slice(R,$);if(I.has(N))throw new SyntaxError(`The "${N}" subprotocol is duplicated`);return I.add(N),I}wI.exports={parse:z4}});var pI=C((s4,lI)=>{var H4=O("events"),Q_=O("http"),{Duplex:o4}=O("stream"),{createHash:A4}=O("crypto"),mI=q_(),w=o(),Q4=hI(),O4=v_(),{GUID:Y4,kWebSocket:j4}=L(),M4=/^[+/0-9A-Za-z]{22}==$/;class uI extends H4{constructor(_,I){super();if(_={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:O4,..._},_.port==null&&!_.server&&!_.noServer||_.port!=null&&(_.server||_.noServer)||_.server&&_.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(_.port!=null)this._server=Q_.createServer((R,K)=>{let $=Q_.STATUS_CODES[426];K.writeHead(426,{"Content-Length":$.length,"Content-Type":"text/plain"}),K.end($)}),this._server.listen(_.port,_.host,_.backlog,I);else if(_.server)this._server=_.server;if(this._server){let R=this.emit.bind(this,"connection");this._removeListeners=T4(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(K,$,N)=>{this.handleUpgrade(K,$,N,R)}})}if(_.perMessageDeflate===!0)_.perMessageDeflate={};if(_.clientTracking)this.clients=new Set,this._shouldEmitClose=!1;this.options=_,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');if(!this._server)return null;return this._server.address()}close(_){if(this._state===2){if(_)this.once("close",()=>{_(new Error("The server is not running"))});process.nextTick(__,this);return}if(_)this.once("close",_);if(this._state===1)return;if(this._state=1,this.options.noServer||this.options.server){if(this._server)this._removeListeners(),this._removeListeners=this._server=null;if(this.clients)if(!this.clients.size)process.nextTick(__,this);else this._shouldEmitClose=!0;else process.nextTick(__,this)}else{let I=this._server;this._removeListeners(),this._removeListeners=this._server=null,I.close(()=>{__(this)})}}shouldHandle(_){if(this.options.path){let I=_.url.indexOf("?");if((I!==-1?_.url.slice(0,I):_.url)!==this.options.path)return!1}return!0}handleUpgrade(_,I,R,K){I.on("error",fI);let $=_.headers["sec-websocket-key"],N=_.headers.upgrade,V=+_.headers["sec-websocket-version"];if(_.method!=="GET"){h(this,_,I,405,"Invalid HTTP method");return}if(N===void 0||N.toLowerCase()!=="websocket"){h(this,_,I,400,"Invalid Upgrade header");return}if($===void 0||!M4.test($)){h(this,_,I,400,"Missing or invalid Sec-WebSocket-Key header");return}if(V!==8&&V!==13){h(this,_,I,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(_)){I_(I,400);return}let Z=_.headers["sec-websocket-protocol"],J=new Set;if(Z!==void 0)try{J=Q4.parse(Z)}catch(z){h(this,_,I,400,"Invalid Sec-WebSocket-Protocol header");return}let G=_.headers["sec-websocket-extensions"],H={};if(this.options.perMessageDeflate&&G!==void 0){let z=new w(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let j=mI.parse(G);if(j[w.extensionName])z.accept(j[w.extensionName]),H[w.extensionName]=z}catch(j){h(this,_,I,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let z={origin:_.headers[`${V===8?"sec-websocket-origin":"origin"}`],secure:!!(_.socket.authorized||_.socket.encrypted),req:_};if(this.options.verifyClient.length===2){this.options.verifyClient(z,(j,M,Q,A)=>{if(!j)return I_(I,M||401,Q,A);this.completeUpgrade(H,$,J,_,I,R,K)});return}if(!this.options.verifyClient(z))return I_(I,401)}this.completeUpgrade(H,$,J,_,I,R,K)}completeUpgrade(_,I,R,K,$,N,V){if(!$.readable||!$.writable)return $.destroy();if($[j4])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return I_($,503);let J=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${A4("sha1").update(I+Y4).digest("base64")}`],G=new this.options.WebSocket(null,void 0,this.options);if(R.size){let H=this.options.handleProtocols?this.options.handleProtocols(R,K):R.values().next().value;if(H)J.push(`Sec-WebSocket-Protocol: ${H}`),G._protocol=H}if(_[w.extensionName]){let H=_[w.extensionName].params,z=mI.format({[w.extensionName]:[H]});J.push(`Sec-WebSocket-Extensions: ${z}`),G._extensions=_}if(this.emit("headers",J,K),$.write(J.concat(`\r
`).join(`\r
`)),$.removeListener("error",fI),G.setSocket($,N,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients)this.clients.add(G),G.on("close",()=>{if(this.clients.delete(G),this._shouldEmitClose&&!this.clients.size)process.nextTick(__,this)});V(G,K)}}lI.exports=uI;function T4(_,I){for(let R of Object.keys(I))_.on(R,I[R]);return function R(){for(let K of Object.keys(I))_.removeListener(K,I[K])}}function __(_){_._state=2,_.emit("close")}function fI(){this.destroy()}function I_(_,I,R,K){R=R||Q_.STATUS_CODES[I],K={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(R),...K},_.once("finish",_.destroy),_.end(`HTTP/1.1 ${I} ${Q_.STATUS_CODES[I]}\r
`+Object.keys(K).map(($)=>`${$}: ${K[$]}`).join(`\r
`)+`\r
\r
`+R)}function h(_,I,R,K,$){if(_.listenerCount("wsClientError")){let N=new Error($);Error.captureStackTrace(N,h),_.emit("wsClientError",N,R,I)}else I_(R,K,$)}});var j_="130.0.2849.68".split(".")[0];var f_={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/${CHROMIUM_MAJOR_VERSION}.0.0.0 Safari/537.36 Edg/${CHROMIUM_MAJOR_VERSION}.0.0.0","Accept-Encoding":"gzip, deflate, br","Accept-Language":"en-US,en;q=0.9"},sI={Pragma:"no-cache","Cache-Control":"no-cache",Origin:"chrome-extension://jdiccldimpdaibmpdkjnbmckianbfold",...f_},tI={Authority:"speech.platform.bing.com","Sec-CH-UA":`" Not;A Brand";v="99", "Microsoft Edge";v="${j_} "Chromium";v="${j_}"`,"Sec-CH-UA-Mobile":"?0",Accept:"*/*","Sec-Fetch-Site":"none","Sec-Fetch-Mode":"cors","Sec-Fetch-Dest":"empty",...f_};var eI={TRUSTED_CLIENT_TOKEN:"6A5AA1D4EAFF4E9FB37E23D68491D6F4",WSS_URL:"wss://speech.platform.bing.com/consumer/speech/synthesize/readaloud/edge/v1?TrustedClientToken=6A5AA1D4EAFF4E9FB37E23D68491D6F4",VOICE_LIST_URL:"https://speech.platform.bing.com/consumer/speech/synthesize/readaloud/voices/list?trustedclienttoken=6A5AA1D4EAFF4E9FB37E23D68491D6F4",CHROMIUM_FULL_VERSION:"130.0.2849.68",CHROMIUM_MAJOR_VERSION:j_,SEC_MS_GEC_VERSION:"1-130.0.2849.68",WSS_HEADERS:sI,VOICE_HEADERS:tI,WIN_EPOCH:11644473600,OUTPUT_FORMATS:{AUDIO_24KHZ_48KBITRATE_MONO_MP3:{tag:"audio-24khz-48kbitrate-mono-mp3",ext:".mp3"},AUDIO_24KHZ_96KBITRATE_MONO_MP3:{tag:"audio-24khz-96kbitrate-mono-mp3",ext:".mp3"},WEBM_24KHZ_16BIT_MONO_OPUS:{tag:"webm-24khz-16bit-mono-opus",ext:".webm"}}},D=Object.freeze(eI);import{createHash as _R,randomUUID as IR}from"crypto";function u_(){let _=D.WSS_URL;return _+="&Sec-MS-GEC-Version=",_+=RR(),_+="&ConnectionId=",_+=M_(),_}function RR(){let I=Math.floor(new Date().getTime()/1000),R=1e9,K=I+D.WIN_EPOCH;K-=K%300,K*=1e7;let $=`${Math.floor(K)}${D.TRUSTED_CLIENT_TOKEN}`;return _R("sha256",$,"hex").toString().toUpperCase()}function M_(){return IR().replaceAll("-","")}import P4 from"fs";class R_{constructor({voice:_="",pitch:I="+0Hz",rate:R="+0%",volume:K="+0%",text:$="",fileType:N=D.OUTPUT_FORMATS.AUDIO_24KHZ_48KBITRATE_MONO_MP3}){this.voice=_,this.pitch=I,this.rate=R,this.volume=K,this.text=$,this.fileType=N}generateSSML(_){let I="";return I+="X-RequestId:",I+=M_(),I+=`\r
Content-Type:application/ssml+xml`,I+=`\r
X-Timestamp:${new Date}Z`,I+=`\r
Path:ssml`,I+=`\r
\r
<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xml:lang='en-US'>`,I+=`\r
\t<voice name='${this.voice}'>`,I+=`\r
\t\t<prosody pitch='${this.pitch}' rate='${this.rate}' volume='${this.volume}'>`,I+=`\r
\t\t\t${this.text}`,I+=`\r
\t\t</prosody>`,I+=`\r
\t</voice>`,I+=`\r
</speak>`,I}generateCommand(){let _="";return _+=`X-Timestamp:${new Date}`,_+=`\r
Content-Type:application/json; charset=utf-8`,_+=`\r
Path:speech.config`,_+=`\r
\r
{"context":{"synthesis":{"audio":{"metadataoptions":{"sentenceBoundaryEnabled":false,"wordBoundaryEnabled":true},"outputFormat":"${this.fileType.tag}"}}}}\r
`,_}}import B4,{resolve as $0}from"path";var C4=c(i_(),1),F4=c(P_(),1),U4=c(L_(),1),bI=c(v_(),1),D4=c(pI(),1);var iI=bI.default;class kI{static fileTypes=D.OUTPUT_FORMATS;static async getVoices(){try{return await(await fetch(D.VOICE_LIST_URL,{headers:D.VOICE_HEADERS})).json()}catch(_){return console.error(_),_}}constructor(_){this.url=u_(),this.tts=new R_(_),this.file=Buffer.alloc(0)}ttsToFile(_=""){return new Promise((I,R)=>{let K=new iI(this.url,{headers:D.WSS_HEADERS});K.binaryType="arraybuffer",K.addEventListener("error",($)=>{K.close(),R($)}),K.addEventListener("close",($)=>{let N=this.tts.text.length>20?20:this.tts.text.length,V=`${this.tts.voice}-${this.tts.text.slice(0,N).trim()}${this.tts.fileType.ext}`,Z=B4.join(_,V);P4.writeFile(Z,this.file,(J)=>{if(J)console.error("Error writing file:",J);I(Z)})}),K.addEventListener("open",()=>{K.send(this.tts.generateCommand()),K.send(this.tts.generateSSML())}),K.addEventListener("message",($)=>{if($.data instanceof ArrayBuffer){let N=Buffer.from($.data);if(N.length>=2){let V=N.readUInt16BE(0)+2,Z=N.subarray(0,V);if(this.parseMessageText(Z.toString()).Path!=="audio")return;let G=N.subarray(V),H=this.file.length+G.length;this.file=Buffer.concat([this.file,G],H)}else console.error("Received data is too short to contain a valid header.")}else if(typeof $.data==="string"){if(this.parseMessageText($.data).Path==="turn.end")K.close(0)}})})}disconnect(){if(this.socket!==null)this.socket.close()}send(_){if(this.socket!==null)this.socket.send(_)}parseMessageText(_){let I={};return _.split(`\r
`).filter((K)=>K!=="").map((K)=>{try{I.metaData=JSON.parse(K)}catch{let[$,N]=K.split(":");I[$]=N}}),I}}export{kI as default};
